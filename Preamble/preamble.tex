% ******************************************************************************
% ****************************** Watermark *********************************

% \usepackage{draftwatermark} % Package to add watermarks
% \usepackage{xcolor}

% % Define a color with transparency
% \definecolor{transparentgray}{gray}{0.5}
% \colorlet{mytranspgray}{transparentgray!30} % 30% of full color

% % Watermark configuration
% \SetWatermarkText{\textcolor{mytranspgray}{Incomplete Draft}}
% \SetWatermarkScale{0.4}


% ******************************************************************************
% ****************************** Custom Margin *********************************

% Add `custommargin' in the document class options to use this section
% Set {innerside margin / outerside margin / topmargin / bottom margin}  and
% other page dimensions

% \ifsetCustomMargin
%   \RequirePackage[left=37mm,right=30mm,top=35mm,bottom=30mm]{geometry}
%   \setFancyHdr % To apply fancy header after geometry package is loaded
% \fi

% Add spaces between paragraphs
%\setlength{\parskip}{0.5em}
% Ragged bottom avoids extra whitespaces between paragraphs
\raggedbottom
% To remove the excess top spacing for enumeration, list and description
%\usepackage{enumitem}
%\setlist[enumerate,itemize,description]{topsep=0em}

% No indent before paragraph
\setlength\parindent{0pt}

% *****************************************************************************
% ******************* Fonts (like different typewriter fonts etc.)*************

% Add `customfont' in the document class option to use this section

\ifsetCustomFont
  % Set your custom font here and use `customfont' in options. Leave empty to
  % load computer modern font (default LaTeX font).
  %\RequirePackage{helvet}

  % For use with XeLaTeX
  %  \setmainfont[
  %    Path              = ./libertine/opentype/,
  %    Extension         = .otf,
  %    UprightFont = LinLibertine_R,
  %    BoldFont = LinLibertine_RZ, % Linux Libertine O Regular Semibold
  %    ItalicFont = LinLibertine_RI,
  %    BoldItalicFont = LinLibertine_RZI, % Linux Libertine O Regular Semibold Italic
  %  ]
  %  {libertine}
  %  % load font from system font
  %  \newfontfamily\libertinesystemfont{Linux Libertine O}
  
  % Use helvetica
  \renewcommand{\familydefault}{\sfdefault}
  %\usepackage{helvet}
  \usepackage{fontspec}
  \usepackage{sansmathfonts}
\fi

% *********
% ***** Custom Packages
\usepackage{float}
\usepackage[leftcaption]{sidecap}

% \usepackage{lineno}
% \linenumbers


% define header 
% \usepackage{fancyhdr}
% \usepackage{adjustbox}
% \usepackage{etoolbox}
% \renewcommand{\headrulewidth}{1pt}
% \newcommand{\headrulecolor}[1]{\patchcmd{\headrule}{\hrule}{\color{#1}\hrule}{}{}}
% \headrulecolor{CadetBlue}
% \fancyheadoffset[RE,LO]{0cm}
% \fancyheadoffset[LE,RO]{1.25cm}

% define header 
\usepackage{fancyhdr}
\usepackage{adjustbox}
\usepackage{etoolbox}
%\usepackage{xcolor} % Ensure xcolor is included for color names



\pagestyle{fancy} % Ensures that fancy page style is applied
\renewcommand{\headrulewidth}{1.2pt}
\fancyhf{} % Clear out all header and footer text

% Apply your custom head rule color
\newcommand{\headrulecolor}[1]{%
  \renewcommand{\headrule}{\hbox to\headwidth{%
    \color{#1}\leaders\hrule height \headrulewidth\hfill}}
}
\headrulecolor{black}

% Set the offsets
\fancyheadoffset[RE,LO]{0cm}
\fancyheadoffset[LE,RO]{0cm}

% Now redefine the headers for even and odd pages
\fancyhead[LE,RO]{\thepage} % Page numbers on the left on even pages, right on odd pages
\fancyhead[RE,LO]{} % Clear section titles from headers



% For recoloring the section header
\usepackage{sectsty}
\definecolor{dark-gray}{gray}{0.30}
\sectionfont{\color{dark-gray}}
\subsectionfont{\color{dark-gray}}
% \subsubsectionfont{\color{dark-gray}}

% Fancier section header
\newcommand{\hsp}{\hspace{6pt}}
\usepackage[explicit]{titlesec}

\titleformat{\section}[display]{\Large\bfseries}{\color{black}\thesection}{6pt}{\begin{tabular}[t]{@{}>{}l}#1\end{tabular}\vspace{3pt}\hrule}

%{\begin{tabular}[t]{@{\color{black}\vrule width 2pt}>{\hsp}l}#1\end{tabular}}

\titleformat{\subsection}[hang]{\large\bfseries}{\color{black}\thesubsection}{6pt}{\begin{tabular}[t]{@{\color{black}\vrule width 2pt}>{\hsp}l}#1\end{tabular}}

%\titleformat{\section}{\normalfont\Large\bfseries}{}{0pt}{}

% % Keep the subsubsection title but remove its numbering
% \titleformat{\subsubsection}
%   {\normalfont\normalsize\bfseries}{\thesubsubsection}{}{}
% \titlespacing*{\subsubsection}
%   {0pt}{3.25ex plus 1ex minus .2ex}{1em}




% **** Algorithms and Pseudocode 

\usepackage[percent]{overpic}

%\usepackage{algpseudocode}


% **** Captions and Hyperreferencing / URL 

% Captions: This makes captions of figures use a boldfaced small font.
\usepackage[font=small,labelfont=bf,justification=justified,format=plain]{caption}  %'format=plain' avoids hanging indentation
\DeclareCaptionLabelFormat{adja-page}{\hrulefill\\#1 #2 \emph{(previous page)}}

%\RequirePackage[labelsep=space,tableposition=top]{caption}
\renewcommand{\figurename}{Fig.} %to support older versions of captions.sty

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=blue,      
    urlcolor=blue,
}

% % Setup for handling chapter and appendix figures separately
% \makeatletter
% \let\oldfigure\figure
% \let\endoldfigure\endfigure
% \renewenvironment{figure}{%
%   \ifnum\value{figure}>0 % Checks if it's not the first figure in the document
%     \setcounter{figure}{\value{figure}}%
%   \else
%     \setcounter{figure}{0}%
%   \fi
%   \oldfigure
% }{%
%   \endoldfigure
% }
% \makeatother

% \newcommand{\myautorefname}{Figure} % Default name

% % Update \autoref to distinguish appendix figures
% \renewcommand{\figureautorefname}{%
%     \ifnumgreater{\value{figure}}{\last@chapter@figure}{%
%         \def\myautorefname{Appendix Figure}% If figure number is greater than last chapter figure
%     }{%
%         \def\myautorefname{Figure}% Normal Figure
%     }%
%     \myautorefname%
% }


% % Redefine autoref names to include square brackets
% \renewcommand{\autoref}[1]{[\oldautoref{#1}]}

% % Save the old \autoref as \oldautoref
% \let\oldautoref\autoref

% % Update \autoref to include brackets
% \renewcommand{\autoref}[1]{[\oldautoref{#1}]}

\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\sectionautorefname}{Sec.}
\renewcommand{\subsectionautorefname}{Sec.}
\renewcommand{\figureautorefname}{Fig.}
\renewcommand{\tableautorefname}{Table}


% \usepackage{booktabs}% http://ctan.org/pkg/booktabs
% \newcommand{\tabitem}{~~\llap{\textbullet}~~}

% *************************** Graphics and figures *****************************

%\usepackage{rotating}
\usepackage{wrapfig}
\usepackage{sidecap}
%\usepackage{rotating}
%\usepackage{showframe}
%\usepackage{pdflscape}

% Uncomment the following two lines to force Latex to place the figure.
% Use [H] when including graphics. Note 'H' instead of 'h'
%\usepackage{float}
%\restylefloat{figure}

% Subcaption package is also available in the sty folder you can use that by
% uncommenting the following line
% This is for people stuck with older versions of texlive
%\usepackage{sty/caption/subcaption}
\usepackage{subcaption}

% ********************************** Tables ************************************
\usepackage{booktabs} % For professional looking tables
\usepackage{multirow}

%\usepackage{multicol}
%\usepackage{longtable}
%\usepackage{tabularx}

%% for appendix tables
\usepackage{tabularx} % For flexible table width
\usepackage[table]{xcolor} % For cell coloring
%\definecolor{headerblue}{cmyk}{0.25,0.6,0,0.1}
\definecolor{CadetBlue}{RGB}{95,158,90} % Define the color if not predefined
\definecolor{headerblue}{RGB}{173,216,230}
\definecolor{rowgray}{RGB}{220,220,220}
\definecolor{selectedrow}{RGB}{144,238,144}
\definecolor{firstcol}{RGB}{144,238,144}
\definecolor{rowblue}{RGB}{173,216,230}
\definecolor{mod1green}{RGB}{104,190,102}
\definecolor{cornflowerblue}{RGB}{114,133,165}
\definecolor{green}{RGB}{32,157,148}
%\usepackage{colortbl}
%\usepackage{geometry} % For page margin settings
%\usepackage[raggedrightboxes]{ragged2e}
%Define the colors used in the table


\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{G}{>{\columncolor{firstcol}}l}

\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcolumntype{W}[1]{>{\raggedright\arraybackslash}p{#1}} % change \raggedright to \centering if you want text centered

\geometry{
  a4paper, % Paper size
  left=35mm, % Left margin
  right=25mm, % Right margin
  top=25mm, % Top margin
  bottom=25mm % Bottom margin
}


\usepackage{makecell}

\renewcommand\theadalign{bc}
\renewcommand\theadfont{\bfseries}
\renewcommand\theadgape{\Gape[4pt]}
\renewcommand\cellgape{\Gape[4pt]}


% *********************************** SI Units *********************************
\usepackage{siunitx} % use this package module for SI units
\usepackage{textcomp} % for trademark
\sisetup{output-exponent-marker=\ensuremath{\mathrm{e}}}


% ******************************* Line Spacing *********************************

% Choose linespacing as appropriate. Default is one-half line spacing as per the
% University guidelines

% \doublespacing
\onehalfspacing
% \singlespacing


% ************************ Formatting / Footnote *******************************

% Don't break enumeration (etc.) across pages in an ugly manner (default 10000)
%\clubpenalty=500
%\widowpenalty=500

%\usepackage[perpage]{footmisc} %Range of footnote options

% Nicer heading
\renewcommand{\chaptername}{}
\usepackage[Sonny]{fncychap}


% *****************************************************************************
% *************************** Bibliography  and References ********************

%\usepackage{cleveref} %Referencing without need to explicitly state fig /table

% Add `custombib' in the document class option to use this section
\ifuseCustomBib
%  \RequirePackage[square, sort, numbers, authoryear]{natbib} % CustomBib

% If you would like to use biblatex for your reference management, as opposed to the default `natbibpackage` pass the option `custombib` in the document class. Comment out the previous line to make sure you don't load the natbib package. Uncomment the following lines and specify the location of references.bib file

% \RequirePackage[backend=biber, style=numeric-comp, citestyle=numeric, sorting=nty, natbib=true]{biblatex}
% \addbibresource{References/references.bib} %Location of references.bib only for biblatex, Do not omit the .bib extension from the filename.
\RequirePackage[backend=biber, style=numeric-comp, citestyle=numeric-comp, sorting=none,natbib=true,doi=true,isbn=false,url=false,maxbibnames=1]{biblatex}
% \RequirePackage[backend=biber, style=authoryear, maxbibnames=99, giveninits=true, uniquename=init, dashed=false]{biblatex}
\addbibresource{References/references.bib} %Location of references.bib only for biblatex, Do not omit the .bib extension from the filename.

% \DeclareBibliographyDriver{article}{%
%   \printnames{author}%
%   \setunit{\addspace}%
%   \printfield{title}%
%   \finentry
% }

% % Remove "In:" for article entries
% \renewbibmacro{in:}{}

% % Omit the month and issn fields
% \AtEveryBibitem{
%   \clearfield{month}
%   \clearfield{issn}
% }

% % Format the volume of journal articles in bold
% \DeclareFieldFormat[article]{volume}{\mkbibbold{#1}}

% % Format the title of journal articles in quotes
% \DeclareFieldFormat[article]{title}{\mkbibquote{#1\isdot}}

% % Custom formatting for the article entry type
% \DeclareBibliographyDriver{article}{%
%   \usebibmacro{bibindex}%
%   \usebibmacro{begentry}%
%   \printnames{author}%
%   \setunit{\addspace}%
%   \printfield{title}%
%   \setunit{\addspace}%
%   \mkbibitalic{\printfield{journaltitle}}%
%   \setunit{\addspace}%
%   \printfield{volume}%
%   \setunit{\addcomma\space}%
%   \printfield{pages}%
%   \setunit{\addspace}%
%   \mkbibparens{\usebibmacro{date}}%
%   \usebibmacro{finentry}
% }

\DefineBibliographyStrings{english}{%
  andothers = {\mkbibemph{et\addabbrvspace al\adddot}},
}

% Remove "In:" for article entries
\renewbibmacro{in:}{%
  \ifentrytype{article}{}{\printtext{\bibstring{in}\intitlepunct}}}

% Omit the month and issn fields
\AtEveryBibitem{
  \clearfield{month}
  \clearfield{issn}
}

% Custom formatting for volume and pages
\DeclareFieldFormat[article]{volume}{\mkbibbold{#1}}% Volume in bold
% \DeclareFieldFormat[article]{issue}{\mkbi{#1}}
\DeclareFieldFormat[article]{pages}{#1} % Pages without prefix

\DeclareFieldFormat[article, inbook, incollection, inproceedings, misc, thesis, unpublished]{title}{#1}


\DeclareFieldFormat{labelnumberwidth}{#1\adddot}

\defbibenvironment{bibliography}
  {\list
     {\printtext[labelnumberwidth]{%
        \printfield{prefixnumber}%
        \printfield{labelnumber}}}
     {\setlength{\labelwidth}{\labelnumberwidth}%
      \setlength{\leftmargin}{\labelwidth}%
      \setlength{\labelsep}{\biblabelsep}%
      \addtolength{\leftmargin}{\labelsep}%
      \setlength{\itemsep}{\bibitemsep}%
      \setlength{\parsep}{\bibparsep}}%
      \renewcommand*{\makelabel}[1]{##1}}
  {\endlist}
  {\item}

% Customizing the bibliography output for articles
\DeclareBibliographyDriver{article}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \printnames{author}%
  \setunit{\addspace}%
  \printfield{title}%
  \newunit\newblock
  \printfield{journaltitle}%
  \setunit{\addspace}%
  \printfield{volume}%
  \setunit{\addcomma\space}%
  \printfield{pages}%
  \setunit{\addspace}%
  \printfield{issn}%
  \setunit{\addspace}%
  \printtext[parens]{\usebibmacro{date}}%
  \setunit{\addspace}%
  \printfield{doi}%
  \usebibmacro{finentry}}

% Customizing the bibliography output for miscellaneous
% \DeclareBibliographyDriver{misc}{%
%   \usebibmacro{bibindex}%
%   \usebibmacro{begentry}%
%   \printfield{title}%
%   \newunit\newblock
%   \printfield{url}%
%   \usebibmacro{finentry}}

\fi

% Formatting DOI
\DeclareFieldFormat{doi}{%
  \mkbibacro{DOI}\addcolon\space \url{#1}%
}

\AtBeginBibliography{\footnotesize}


% changes the default name `Bibliography` -> `References'
\renewcommand{\bibname}{Bibliography}


% ******************************************************************************
% ************************* User Defined Commands ******************************
% ******************************************************************************

% **** To change the name of Table of Contents / LOF and LOT 
\usepackage{tocloft}
\setlength\cftaftertoctitleskip{0pt}
\setlength\cftafterloftitleskip{0pt}
\setlength\cftafterlottitleskip{0pt}
\renewcommand\cfttoctitlefont{\LARGE\bfseries\scshape\color{black}}
\renewcommand\cftloftitlefont{\LARGE\bfseries\scshape\color{black}}
\renewcommand\cftlottitlefont{\LARGE\bfseries\scshape\color{black}}

%\renewcommand{\glossarysection}[2][\theglstoctitle]{%
%  \def\theglstoctitle{#2}%
%  \vspace{\cftbeforelottitleskip}%
%  \par\noindent
%  \addcontentsline{toc}{chapter}{\numberline{}#1}%
%}

%\renewcommand{\contentsname}{\textcolor{Mahogany}{\LARGE \textbf{\textsc{Table of contents}}}}
%\renewcommand{\listfigurename}{\textcolor{Mahogany}{\LARGE \textbf{\textsc{List of figures}}}}
%\renewcommand{\listtablename}{\textcolor{Mahogany}{\LARGE \textbf{\textsc{List of tables}}}}

% Math abbreviations
\newcommand{\iid}{\stackrel{\mbox{iid}}{\sim}}
\newcommand{\ind}{\stackrel{\mbox{ind}}{\sim}}
\newcommand{\Lagr}{\mathcal{L}}
\newcommand{\plus}{\textsuperscript{+}}
\usepackage{tikz}
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;} 



% ********************** TOC depth and numbering depth *************************

\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}

% \usepackage{crop}
% \crop[cam]  % This command adds crop marks


% ******************************* Nomenclature 
%\usepackage{nomencl}
%\renewcommand{\nomname}{Symbols}
%\makenomenclature

\usepackage[acronym, nopostdot, nonumberlist, style=super]{glossaries}
\setlength{\glsdescwidth}{5in}

\makeglossaries
%\glsdisablehyper


% ********************************* Appendix 

% The default value of both \appendixtocname and \appendixpagename is `Appendices'. These names can all be changed via:

%\renewcommand{\appendixtocname}{List of appendices}
%\renewcommand{\appendixname}{Appndx}

% *********************** Configure Draft Mode **********************************

% Uncomment to disable figures in `draft'
%\setkeys{Gin}{draft=true}  % set draft to false to enable figures in `draft'

% These options are active only during the draft mode
% Default text is "Draft"
%\SetDraftText{DRAFT}

% Default Watermark location is top. Location (top/bottom)
%\SetDraftWMPosition{bottom}

% Draft Version - default is v1.0
%\SetDraftVersion{v1.1}

% Draft Text grayscale value (should be between 0-black and 1-white)
% Default value is 0.75
%\SetDraftGrayScale{0.8}


% ******************************** Todo Notes **********************************

% Define colour for todo notes
\newcommand{\todo}[1]{{\color{red}{#1}}}
% Colour for corrections
\newcommand{\cor}[1]{{\color{blue}{#1}}}

% *****************************************************************************
% ******************* Better enumeration my MB*************
\usepackage{enumitem}

% **********************************
% Additional packages
%\usepackage{xcolor}

\usepackage{amsmath,amsfonts,amssymb,amsthm,nccmath,systeme} % For math equations, theorems, symbols, etc
\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n} % reset mathcal to normal
\usepackage{bm} % bold math 
\usepackage{textgreek} % greek letters in text
\usepackage{upgreek}
\usepackage{soul}
%----------------------------------------------------------------------------------------
%	THEOREM STYLES
%----------------------------------------------------------------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% dedicated to boxed/framed environements %%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtheoremstyle{greennumbox}% % Theorem style name
{0pt}% Space above
{0pt}% Space below
{\small}% % Body font
{}% Indent amount
{\small\bf\sffamily\color{green}}% % Theorem head font
{\;}% Punctuation after theorem head
{0.25em}% Space after theorem head
{\small\sffamily\color{green}\thmname{}\nobreakspace} 
\renewcommand{\qedsymbol}{$\blacksquare$}% Optional qed square

\newtheoremstyle{blacknumbox} % Theorem style name
{0pt}% Space above
{0pt}% Space below
{\normalfont}% Body font
{}% Indent amount
{\small\bf\sffamily}% Theorem head font
{}% Punctuation after theorem head
{0.25em}% Space after theorem head
{\small\sffamily\thmname{}\nobreakspace}

\newtheoremstyle{bluenumbox} % Theorem style name
{0pt}% Space above
{0pt}% Space below
{\normalfont}% Body font
{}% Indent amount
{\small\bf\sffamily\color{blue}}% Theorem head font
{}% Punctuation after theorem head
{0.25em}% Space after theorem head
{\small\sffamily\thmname{}\nobreakspace}

% Defines the theorem text style for each type of theorem to one of the three styles above
\theoremstyle{greennumbox}
\newtheorem{abstractT}{}
\theoremstyle{bluenumbox}
\newtheorem{boxT}{}
\theoremstyle{blacknumbox}
\newtheorem{commentT}{}


% Package to create coloured boxes
\RequirePackage[framemethod=default]{mdframed}

% Exercise box	  
\newmdenv[skipabove=7pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
backgroundcolor=green!10,
linecolor=green,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
innerbottommargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt]{eBox}



\newmdenv[skipabove=10pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
backgroundcolor=cornflowerblue!10,
linecolor=cornflowerblue,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
innerbottommargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt
innerbottommargin=5pt]{bBox}

\newmdenv[skipabove=7pt,
skipbelow=7pt,
rightline=false,
leftline=true,
topline=false,
bottomline=false,
linecolor=gray,
backgroundcolor=black!5,
innerleftmargin=5pt,
innerrightmargin=5pt,
innertopmargin=5pt,
leftmargin=0cm,
rightmargin=0cm,
linewidth=4pt,
innerbottommargin=5pt]{cBox}

% Creates an environment for each type of theorem and assigns it a theorem text style from the "Theorem Styles" section above and a colored box from above

% \newenvironment{Abstract}{\begin{eBox}\begin{abstractT}}{\hfill{\color{green}\tiny\ensuremath{\blacksquare}}\end{abstractT}\end{eBox}}
\newenvironment{Abstract}{\begin{eBox}\begin{abstractT}}{\end{abstractT}\end{eBox}}
\newenvironment{Comment}{\begin{cBox}\begin{commentT}}{\end{commentT}\end{cBox}}	\newenvironment{Comment2}{\begin{bBox}\begin{boxT}}{\end{boxT}\end{bBox}}

\usepackage{xargs,lipsum,changepage,ifthen}

\newcommandx{\mycaptionminipage}[3][3=c,usedefault]{%
    \begin{minipage}[#3]{#1}%
        \ifthenelse{\equal{#3}{b}}{\captionsetup{aboveskip=0pt}}{}
        \ifthenelse{\equal{#3}{t}}{\captionsetup{belowskip=0pt}}{}
        \vspace{0pt}\centering\captionsetup{width=\textwidth} %Temporarily set caption width
        #2%
    \end{minipage}%
}%
\newcommandx{\mysidecaption}[4][4=c,usedefault]{%
    \checkoddpage%
    \ifoddpage%
        %CASE ODD PAGES
        \mycaptionminipage{\dimexpr\linewidth-#1\linewidth-\intextsep\relax}{#3}[#4]%
        \hfill%
        \mycaptionminipage{#1\linewidth}{#2}[#4]%
    \else%
        %CASE EVEN PAGES
        \mycaptionminipage{#1\linewidth}{#2}[#4]%
        \hfill%
        \mycaptionminipage{\dimexpr\linewidth-#1\linewidth-\intextsep\relax}{#3}[#4]%
    \fi%
}%


\usepackage{comment}
\usepackage{verbatim}  % for \verbatiminput
